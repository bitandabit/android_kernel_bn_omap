/*
 * Copyright (C) 2016 D. Andrei Măceș <dmaces@nd.edu>
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 as
 * published by the Free Software Foundation.
 */
/dts-v1/;

#include "omap4460.dtsi"
#include "elpida_ecb240abacn.dtsi"

/ {
	model = "B&N Nook HD (hummingbird)";
	compatible = "bn,omap4-bn-hd", "ti,omap4460", "ti,omap4430", "ti,omap4";

	memory {
		device_type = "memory";
		reg = <0x80000000 0x40000000>; // 1 GB
	};

	chosen {
		bootargs = "androidboot.hardware=hummingbird console=ttyO0,115200n8";
	};

	aliases {
		display0 = &hdmi0;
	};

	hdmi0: connector {
		compatible = "hdmi-connector";
		pinctrl-names = "default";
		pinctrl-0 = <&hdmi_hpd_pins>;
		label = "hdmi";
		type = "a";

		hpd-gpios = <&gpio2 31 GPIO_ACTIVE_HIGH>; // gpio_63

		port {
			hdmi_connector_in: endpoint {
				remote-endpoint = <&hdmi_out>;
			};
		};
	};
};

&omap4_pmx_core {
/*	pinctrl-names = "default";
	pinctrl-0 = <
			&dss_hdmi_pins
			&tpd12s015_pins
	>;	*/

	uart1_pins: pinmux_uart1_pins {
		pinctrl-single,pins = <
			OMAP4_IOPAD(0x126, PIN_INPUT_PULLUP | MUX_MODE1)	// i2c2_scl.uart1_rx
			OMAP4_IOPAD(0x128, PIN_OUTPUT | MUX_MODE1)			// i2c2_sda.uart1_tx
		>;
	};

	uart3_pins: pinmux_uart3_pins {
		pinctrl-single,pins = <
			OMAP4_IOPAD(0x140, PIN_INPUT_PULLUP | MUX_MODE0)	// uart3_cts_rctx.uart3_cts_rctx
			OMAP4_IOPAD(0x142, PIN_OUTPUT | MUX_MODE0)			// uart3_rts_sd.uart3_rts_sd
			OMAP4_IOPAD(0x144, PIN_INPUT | MUX_MODE0)			// uart3_rx_irrx.uart3_rx_irrx
			OMAP4_IOPAD(0x146, PIN_OUTPUT | MUX_MODE0)			// uart3_tx_irtx.uart3_tx_irtx
		>;
	};

	uart4_pins: pinmux_uart4_pins {
		pinctrl-single,pins = <
			OMAP4_IOPAD(0x110, PIN_INPUT_PULLUP | MUX_MODE5)	// abe_dmic_clk1.uart4_cts
			OMAP4_IOPAD(0x112, PIN_OUTPUT | MUX_MODE5)			// abe_dmic_din1.uart4_rts
			OMAP4_IOPAD(0x15c, PIN_INPUT_PULLUP | MUX_MODE0)	// uart4_rx.uart4_rx
			OMAP4_IOPAD(0x15e, PIN_OUTPUT | MUX_MODE0)			// uart4_tx.uart4_tx
		>;
	};

	twl6040_pins: pinmux_twl6040_pins {
		pinctrl-single,pins = <
			OMAP4_IOPAD(0x0fa, PIN_OUTPUT | MUX_MODE3)			// abe_mcbsp2_dx.gpio_112
			OMAP4_IOPAD(0x1a0, PIN_INPUT_PULLUP | MUX_MODE0)	// sys_nirq2.sys_nirq2

			OMAP4_IOPAD(0x0d2, PIN_INPUT | PIN_INPUT_PULLDOWN | MUX_MODE2)	// usbb1_ulpitll_dat4.abe_mcbsp3_dr
			OMAP4_IOPAD(0x0d4, PIN_OUTPUT | PIN_OFF_OUTPUT_LOW | MUX_MODE2)	// usbb1_ulpitll_dat5.abe_mcbsp3_dx
			OMAP4_IOPAD(0x0d6, PIN_INPUT | PIN_OFF_INPUT_PULLDOWN | MUX_MODE2)// usbb1_ulpitll_dat6.abe_mcbsp3_clkx
			OMAP4_IOPAD(0x0d8, PIN_INPUT | PIN_OFF_INPUT_PULLDOWN | MUX_MODE2)// usbb1_ulpitll_dat7.abe_mcbsp3_fsx
		>;
	};

	dss_hdmi_pins: pinmux_dss_hdmi_pins {
		pinctrl-single,pins = <
			OMAP4_IOPAD(0x09a, PIN_INPUT_PULLUP | MUX_MODE0)	// hdmi_cec.hdmi_cec
			OMAP4_IOPAD(0x09c, PIN_INPUT | MUX_MODE0)			// hdmi_ddc_scl.hdmi_ddc_scl
			OMAP4_IOPAD(0x09e, PIN_INPUT | MUX_MODE0)			// hdmi_ddc_sda.hdmi_ddc_sda
		>;
	};

	hdmi_hpd_pins: pinmux_hdmi_hpd_pins {
		pinctrl-single,pins = <
			OMAP4_IOPAD(0x098, PIN_INPUT_PULLDOWN | MUX_MODE3)	// hdmi_hpd.gpio_63
		>;
	};

	i2c1_pins: pinmux_i2c1_pins {
		pinctrl-single,pins = <
			OMAP4_IOPAD(0x122, PIN_INPUT_PULLUP | MUX_MODE0)	// i2c1_scl.i2c1_scl
			OMAP4_IOPAD(0x124, PIN_INPUT_PULLUP | MUX_MODE0)	// i2c1_sda.i2c1_sda
		>;
	};

	i2c3_pins: pinmux_i2c3_pins {
		pinctrl-single,pins = <
			OMAP4_IOPAD(0x12a, PIN_INPUT_PULLUP | MUX_MODE0)	// i2c3_scl.i2c3_scl
			OMAP4_IOPAD(0x12c, PIN_INPUT_PULLUP | MUX_MODE0)	// i2c3_sda.i2c3_sda
		>;
	};

	bq24190_pins: pinmux_bq24190_pins {
		pinctrl-single,pins = <
			OMAP4_IOPAD(0x142, PIN_INPUT | MUX_MODE3)	// uart3_rts_sd.gpio_142
			OMAP4_IOPAD(0x0c4, PIN_OUTPUT | MUX_MODE3)	// usbb1_ulpitll_stp.gpio_85
			OMAP4_IOPAD(0x162, PIN_OUTPUT | MUX_MODE3)	// usbb2_ulpitll_stp.gpio_152
		>;
	};
};

&i2c1 {
	pinctrl-names = "default";
	pinctrl-0 = <&i2c1_pins>;

	clock-frequency = <400000>;

	twl: twl@48 {
		reg = <0x48>;
		// SPI = 0, IRQ# = 7, 4 = active high level-sensitive
		interrupts = <GIC_SPI 7 IRQ_TYPE_LEVEL_HIGH>;    // IRQ_SYS_1N cascaded to gic
	};

	twl6040: twl@4b {
		compatible = "ti,twl6040";
		reg = <0x4b>;

		#gpio-cells = <1>;	// provides GPO lines

		pinctrl-names = "default";
		pinctrl-0 = <&twl6040_pins>;

		// SPI = 0, IRQ# = 119, 4 = active high level-sensitive
		interrupts = <GIC_SPI 119 IRQ_TYPE_LEVEL_HIGH>;  // IRQ_SYS_2N cascaded to gic
		ti,audpwron-gpio = <&gpio4 16 GPIO_ACTIVE_HIGH>; // gpio line 112

		vio-supply = <&v1v8>;
		v2v1-supply = <&v2v1>;
		enable-active-high;

		//clocks = <&clk32kgaudio>;
		//clock-names = "clk32k";
		//status = "disabled";
	};
};

#include "twl6030.dtsi"
#include "twl6030_omap4.dtsi"

&vusim {
	//status = "disabled";
	//compatible = "ti,twl6032-ldo7";
	regulator-min-microvolt = <1800000>;
	regulator-max-microvolt = <1800000>;
	regulator-always-on;
	regulator-boot-on;
};

&vdac {
	//status = "disabled";
	//compatible = "ti,twl6032-ldoln";
	regulator-min-microvolt = <1800000>;
	regulator-max-microvolt = <1800000>;
	regulator-always-on;
};

&vaux2 {
	//status = "disabled";
	//compatible = "ti,twl6032-ldo4";
	regulator-min-microvolt = <1800000>;
	regulator-max-microvolt = <1800000>;
};

&vaux3 {
	//status = "disabled";
	//compatible = "ti,twl6032-ldo3";
	regulator-min-microvolt = <1800000>;
	regulator-max-microvolt = <1800000>;
	regulator-boot-on;
};

&twl {
	ldo3: regulator-ldo3 {
		compatible = "ti,twl6032-ldo3";
		regulator-min-microvolt = <1800000>;
		regulator-max-microvolt = <1800000>;
		regulator-boot-on;
	};

	ldo4: regulator-ldo4 {
		compatible = "ti,twl6032-ldo4";
		regulator-min-microvolt = <1800000>;
		regulator-max-microvolt = <1800000>;
	};

	ldo7: regulator-ldo7 {
		compatible = "ti,twl6032-ldo7";
		regulator-min-microvolt = <1800000>;
		regulator-max-microvolt = <1800000>;
		regulator-always-on;
		regulator-boot-on;
	};

	ldoln: regulator-ldoln {
		compatible = "ti,twl6032-ldoln";
		regulator-min-microvolt = <1800000>;
		regulator-max-microvolt = <1800000>;
		ldoln-supply = <&v2v1>;
		regulator-always-on;
	};
};

&i2c2 {
	status = "disabled";
};

&i2c3 {
	pinctrl-names = "default";
	pinctrl-0 = <&i2c3_pins>;

	clock-frequency = <400000>;

	battery: bq27510@55 {
		compatible = "ti,bq27510";
		reg = <0x55>;
		//status = "disabled";
	};

	charger: bq24190@6b {
		compatible = "ti,bq24190";
		reg = <0x6b>;
		pinctrl-names = "default";
		pinctrl-0 = <&bq24190_pins>;
		interrupt-parent = <&gpio5>;
		interrupts = <14 IRQ_TYPE_EDGE_FALLING>; // gpio 142
		status = "disabled";
	};
};

&i2c4 {
	status = "disabled";
};

&gpio1 {
	ti,no-reset-on-init;
};

&gpio2 {
	ti,no-reset-on-init;
};

&gpio3 {
	ti,no-reset-on-init;
};

&gpio5 {
	ti,no-reset-on-init;
};

&mmc1 {
	vmmc-supply = <&vmmc>;
	bus-width = <4>;
};

&mmc2 {
	vmmc-supply = <&vaux1>;
	bus-width = <8>;
	ti,non-removable;
};

&mmc3 {
	status = "disabled";
	//bus-width = <4>;
	//ti,non-removable;
	//cap-power-off-card;
};

&mmc4 {
	status = "disabled";
};

&mmc5 {
	status = "disabled";
};

&emif1 {
	//cs1-used;
	device-handle = <&elpida_ECB240ABACN>;
};

&emif2 {
	//cs1-used;
	device-handle = <&elpida_ECB240ABACN>;
};

&uart1 {
	pinctrl-names = "default";
	pinctrl-0 = <&uart1_pins>;
	ti,no-reset-on-init;
	ti,no_idle_on_suspend;
	ti,no-idle-on-init;
};

&uart4 {
	pinctrl-names = "default";
	pinctrl-0 = <&uart4_pins>;
	ti,no_idle_on_suspend;
};

&twl_usb_comparator {
	usb-supply = <&vusb>;
};

&usb_otg_hs {
	interface-type = <1>;
	mode = <3>;
	power = <50>;
};

&dss {
	status = "ok";
};

&hdmi {
	status = "ok";
	pinctrl-names = "default";
	pinctrl-0 = <&dss_hdmi_pins>;
	vdda-supply = <&vdac>;

	port {
		hdmi_out: endpoint {
			remote-endpoint = <&hdmi_connector_in>;
		};
	};
};
